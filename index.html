<!DOCTYPE html>
<html>
<head>
    <title>Sierra Surf 2014b Blue Pre-NPL</title>

    <script src="firebase-config.js"></script>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
        
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                min-height: 100vh;
            }
            
            .header {
                background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #06b6d4 100%);
                color: white;
                padding: 40px 30px;
                text-align: center;
                border-radius: 15px;
                margin-bottom: 40px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                position: relative;
                overflow: hidden;
            }
            
            .header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('https://sierrasurfsoccerclub.net/wp-content/uploads/2023/04/Sierra-Surf-Logo-3D-shield-blackoutline-232x300-1.png') no-repeat center right;
                background-size: 120px;
                opacity: 0.1;
                pointer-events: none;
            }
            
            .header-content {
                position: relative;
                z-index: 2;
            }
            
            .logo-container {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 20px;
                margin-bottom: 20px;
            }
            
            .logo {
                width: 80px;
                height: auto;
                /* filter: brightness(0) invert(1); */
            }
            
            .header h1 {
                margin: 0;
                font-size: 2.8rem;
                font-weight: 700;
                letter-spacing: -1px;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            }
            
            .header p {
                margin: 10px 0 0 0;
                font-size: 1.3rem;
                opacity: 0.95;
                font-weight: 300;
            }
            
            .main-content {
                text-align: center;
                max-width: 600px;
                margin: 0 auto;
            }
            
            .nav-buttons {
                display: flex;
                flex-direction: column;
                gap: 20px;
                max-width: 400px;
                margin: 0 auto;
            }
            
            .nav-btn {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border: 2px solid #e2e8f0;
                color: #1e40af;
                padding: 25px;
                border-radius: 15px;
                font-size: 18px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: left;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08);
                position: relative;
                overflow: hidden;
            }
            
            .nav-btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
                transition: left 0.5s ease;
            }
            
            .nav-btn:hover::before {
                left: 100%;
            }
            
            .nav-btn:hover {
                background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
                color: white;
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
                border-color: #3b82f6;
            }
            
            .btn-title {
                font-size: 22px;
                margin-bottom: 8px;
                font-weight: 700;
            }
            
            .btn-desc {
                font-size: 14px;
                opacity: 0.8;
                font-weight: 400;
                line-height: 1.4;
            }
            
            .page {
                display: none;
                position: relative;
                z-index: 1;
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                min-height: 100vh;
                padding: 0;
                margin: 0;
            }

            .page.active {
                display: block;
                position: relative;
                z-index: 2;
            }

            .page-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
                padding: 20px 30px;
            }
            
            .back-btn {
                background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 10px;
                cursor: pointer;
                font-size: 16px;
                font-weight: 600;
                transition: all 0.3s ease;
            }
            
            .back-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
            }
            
            .form-container {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border: 2px solid #e2e8f0;
                padding: 30px;
                border-radius: 15px;
                max-width: 600px;
                margin: 0 auto;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08);
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
            }
            
            .form-container::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
                transition: left 0.5s ease;
            }

            .form-container:hover::before {
                left: 100%;
            }

            .form-container:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
                border-color: #3b82f6;
            }
            
            .form-group {
                margin: 25px 0;
            }
            
            .form-group label {
                display: block;
                margin-bottom: 10px;
                font-weight: 600;
                color: #1e40af;
                font-size: 16px;
            }
            
            .form-group input, .form-group textarea {
                width: 100%;
                padding: 15px 18px;
                border: 2px solid #e2e8f0;
                border-radius: 12px;
                font-size: 16px;
                box-sizing: border-box;
                transition: all 0.3s ease;
                font-family: inherit;
            }
            
            .form-group input:focus, .form-group textarea:focus {
                outline: none;
                border-color: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }
            
            .btn {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border: 2px solid #e2e8f0;
                color: #1e40af;
                padding: 20px 35px;
                border-radius: 12px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: center;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08);
                position: relative;
                overflow: hidden;
                margin: 0 10px;
                text-transform: none;
                letter-spacing: normal;
            }

            .btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
                transition: left 0.5s ease;
            }

            .btn:hover::before {
                left: 100%;
            }

            .btn:hover {
                background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
                color: white;
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
                border-color: #3b82f6;
            }
            
            .btn-save {
                background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
                color: white;
                border-color: #3b82f6;
                box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            }

            .btn-save:hover {
                background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
                border-color: #1e40af;
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
                transform: translateY(-3px);
            }
            
            .btn-cancel {
                background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
                color: white;
                border-color: #6b7280;
            }
            
            .btn-cancel:hover {
                background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
                border-color: #4b5563;
                box-shadow: 0 8px 25px rgba(107, 114, 128, 0.3);
                transform: translateY(-3px);
            }
            
            .roster-list {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border: 2px solid #e2e8f0;
                border-radius: 15px;
                padding: 25px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08);
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .roster-list::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
                transition: left 0.5s ease;
            }

            .roster-list:hover::before {
                left: 100%;
            }

            .roster-list:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
                border-color: #3b82f6;
            }
            
            .player-item {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border: 2px solid #e2e8f0;
                color: #1e40af;
                padding: 25px;
                border-radius: 15px;
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08);
                position: relative;
                overflow: hidden;
            }

            .player-item::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
                transition: left 0.5s ease;
            }

            .player-item:hover::before {
                left: 100%;
            }

            .player-item:hover {
                background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
                color: white;
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
                border-color: #3b82f6;
            }

            .player-item:hover .player-name {
                color: white;
            }

            .player-item:hover div[style*="color"] {
                color: rgba(255, 255, 255, 0.9) !important;
            }
            
            .player-item:last-child {
                margin-bottom: 0;
            }
            
            .player-name {
                font-size: 18px;
                font-weight: 700;
            }
            
            .empty-message {
                text-align: center;
                color: #64748b;
                font-style: italic;
                padding: 40px;
                font-size: 16px;
            }
            
            .admin-section {
                margin: 30px 0;
                padding: 20px 0;
            }
            
            .admin-info-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 15px;
                margin: 20px 0;
            }
            
            .admin-info-item {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border: 2px solid #e2e8f0;
                padding: 20px;
                border-radius: 12px;
                border-left: 4px solid #3b82f6;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08);
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .admin-info-item::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
                transition: left 0.5s ease;
            }

            .admin-info-item:hover::before {
                left: 100%;
            }

            .admin-info-item:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
                border-color: #3b82f6;
            }
            
            .admin-info-item strong {
                color: #1e40af;
                margin-right: 10px;
                font-weight: 600;
            }
            
            .response-item {
                margin: 20px 0;
                padding: 25px;
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border: 2px solid #e2e8f0;
                border-radius: 12px;
                border-left: 4px solid #10b981;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08);
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .response-item::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(16, 185, 129, 0.1), transparent);
                transition: left 0.5s ease;
            }

            .response-item:hover::before {
                left: 100%;
            }

            .response-item:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
                border-color: #10b981;
            }
            
            .response-item strong {
                display: block;
                margin-bottom: 12px;
                color: #1e40af;
                font-weight: 600;
                font-size: 16px;
            }
            
            .response-text {
                color: #64748b;
                line-height: 1.6;
                font-style: italic;
                font-size: 15px;
            }
            
            .response-text.answered {
                font-style: normal;
                color: #334155;
                font-weight: 500;
            }

            .main-content {
                padding: 20px 30px;
            }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="header">
            <div class="header-content">
                <h1>Sierra Surf 2014b Blue Pre-NPL</h1>
                <p>Coach Login Required</p>
            </div>
        </div>
        
        <div class="main-content">
            <div class="form-container" style="max-width: 400px;">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="Enter your coach email">
                </div>
                
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password">
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-save" onclick="loginCoach()" id="loginBtn">Sign In</button>
                </div>
                
                <div id="loginError" style="color: #ef4444; text-align: center; margin-top: 15px; display: none;"></div>
                
                <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <p style="color: #666; font-size: 14px;">Need an account? Contact the head coach to create your login.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Home Page -->
    <div id="homePage" class="page active">
        <div class="header">
            <div class="header-content">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div class="logo-container">
                            <img src="https://sierrasurfsoccerclub.net/wp-content/uploads/2023/04/Sierra-Surf-Logo-3D-shield-blackoutline-232x300-1.png" alt="Sierra Surf Soccer Club" class="logo">
                            <div>
                                <h1>Sierra Surf 2014b Blue Pre-NPL</h1>
                                <p>Player Questionnaires</p>
                            </div>
                        </div>
                    </div>
                    <button onclick="signOutCoach()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease;">Sign Out</button>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="nav-buttons">
                <button class="nav-btn" onclick="showAddPlayer()">
                    <div class="btn-title">Add Player</div>
                    <div class="btn-desc">Add a new player to the roster</div>
                </button>
                
                <button class="nav-btn" onclick="showRoster()">
                    <div class="btn-title">View Roster</div>
                    <div class="btn-desc">View all players and select one to edit</div>
                </button>
                
                <button class="nav-btn" onclick="showAddCoach()">
                    <div class="btn-title">Add Coach</div>
                    <div class="btn-desc">Add coaching staff to the system</div>
                </button>
                
                <button class="nav-btn" onclick="showAdmin()">
                    <div class="btn-title">Admin</div>
                    <div class="btn-desc">Manage all player data and responses</div>
                </button>
            </div>
        </div>
    </div>

    <!-- Add Player Page -->
    <div id="addPlayerPage" class="page">
        <div class="page-header">
            <h2>Add New Player</h2>
            <button class="back-btn" onclick="showHome()">← Back to Home</button>
        </div>
        
        <div class="form-container">
            <div class="form-group">
                <label>Player Name</label>
                <input type="text" id="newPlayerName" placeholder="Enter player name">
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-save" onclick="saveNewPlayer()">Save Player</button>
                <button class="btn btn-cancel" onclick="showHome()">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Roster Page -->
    <div id="rosterPage" class="page">
        <div class="page-header">
            <h2>Team Roster</h2>
            <button class="back-btn" onclick="showHome()">← Back to Home</button>
        </div>
        
        <div class="roster-list" id="rosterList">
            <div class="empty-message">No players in roster yet</div>
        </div>
    </div>
    
    <!-- Add Coach Page -->
    <div id="addCoachPage" class="page">
        <div class="page-header">
            <h2>Add New Coach</h2>
            <button class="back-btn" onclick="showHome()">← Back to Home</button>
        </div>
        
        <div class="form-container">
            <div class="form-group">
                <label>Coach Name</label>
                <input type="text" id="newCoachName" placeholder="Enter coach name">
            </div>
            
            <div class="form-group">
                <label>Role</label>
                <input type="text" id="coachRole" placeholder="Head Coach, Assistant Coach, etc.">
            </div>
            
            <div class="form-group">
                <label>Email (Optional)</label>
                <input type="email" id="coachEmail" placeholder="coach@email.com">
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-save" onclick="saveNewCoach()">Save Coach</button>
                <button class="btn btn-cancel" onclick="showHome()">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Admin Page -->
    <div id="adminPage" class="page">
        <div class="page-header">
            <h2>Admin Panel</h2>
            <button class="back-btn" onclick="showHome()">← Back to Home</button>
        </div>
        
        <div class="roster-list" id="adminRosterList">
            <div class="empty-message">No players in system yet</div>
        </div>
    </div>
    
    <!-- Admin Player Detail Page -->
    <div id="adminPlayerPage" class="page">
        <div class="page-header">
            <h2 id="adminPlayerTitle">Player Admin</h2>
            <button class="back-btn" onclick="showAdmin()">← Back to Admin</button>
        </div>
        
        <div class="form-container">
            <div class="admin-section">
                <h3 style="color: #3b82f6; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;">Player Information</h3>
                <div class="admin-info-grid">
                    <div class="admin-info-item">
                        <strong>Name:</strong> <span id="adminPlayerName">-</span>
                    </div>
                    <div class="admin-info-item">
                        <strong>Position Number:</strong> <span id="adminPlayerNumber">-</span>
                    </div>
                    <div class="admin-info-item">
                        <strong>Position Name:</strong> <span id="adminPlayerPosition">-</span>
                    </div>
                </div>
            </div>
            
            <div class="admin-section">
                <h3 style="color: #3b82f6; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;">Goal & Corner Kick Card Responses</h3>
                
                <div class="response-item">
                    <strong>Goal Kick: Where should you be on the pitch/field?</strong>
                    <div class="response-text" id="adminGoalKick">Not answered</div>
                </div>
                
                <div class="response-item">
                    <strong>Corner Kick (Defending): Where should you be on the pitch/field?</strong>
                    <div class="response-text" id="adminCornerKick">Not answered</div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-save" onclick="generatePlayerLink()">Generate Player Link</button>
                <button class="btn btn-save" onclick="printPlayerCard()">Print Player Card</button>
                <button class="btn" onclick="deletePlayerAdmin()" style="background: #ef4444; color: white;">Delete Player</button>
            </div>
            
            <div id="playerLinkSection" style="display: none; margin-top: 30px; padding: 20px; background: #f0f8ff; border-radius: 8px; border: 2px solid #3b82f6;">
                <h4 style="color: #3b82f6; margin: 0 0 15px 0;">Direct Player Link</h4>
                <p style="margin: 10px 0; color: #666; font-size: 14px;">Send this link to the player so they can access their page directly:</p>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="playerLinkInput" readonly style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background: white; font-family: monospace; font-size: 14px;">
                    <button onclick="copyPlayerLink()" style="padding: 10px 15px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Copy</button>
                </div>
                <p style="margin: 10px 0 0 0; color: #666; font-size: 12px;">Players can bookmark this link or access it anytime to update their information.</p>
            </div>
        </div>
    </div>
    
    <!-- Admin Coach Detail Page -->
    <div id="adminCoachPage" class="page">
        <div class="page-header">
            <h2 id="adminCoachTitle">Coach Admin</h2>
            <button class="back-btn" onclick="showAdmin()">← Back to Admin</button>
        </div>
        
        <div class="form-container">
            <div class="admin-section">
                <h3 style="color: #10b981; border-bottom: 2px solid #10b981; padding-bottom: 10px;">Coach Information</h3>
                <div class="admin-info-grid">
                    <div class="admin-info-item" style="border-left: 4px solid #10b981;">
                        <strong>Name:</strong> <span id="adminCoachName">-</span>
                    </div>
                    <div class="admin-info-item" style="border-left: 4px solid #10b981;">
                        <strong>Role:</strong> <span id="adminCoachRole">-</span>
                    </div>
                    <div class="admin-info-item" style="border-left: 4px solid #10b981;">
                        <strong>Email:</strong> <span id="adminCoachEmail">-</span>
                    </div>
                    <div class="admin-info-item" style="border-left: 4px solid #10b981;">
                        <strong>Added Date:</strong> <span id="adminCoachAdded">-</span>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-save" onclick="showCoachEditPage()">Edit Coach</button>
                <button class="btn" onclick="deleteCoachAdmin()" style="background: #ef4444; color: white;">Delete Coach</button>
            </div>
        </div>
    </div>
    
    <!-- Coach Edit Page -->
    <div id="coachPage" class="page">
        <div class="page-header">
            <h2 id="coachPageTitle">Coach Details</h2>
            <button class="back-btn" onclick="showAdminCoach()">← Back to Coach Admin</button>
        </div>
        
        <div class="form-container">
            <div class="form-group">
                <label>Coach Name</label>
                <input type="text" id="coachName" placeholder="Enter coach name">
            </div>
            
            <div class="form-group">
                <label>Role</label>
                <input type="text" id="coachRoleEdit" placeholder="Head Coach, Assistant Coach, etc.">
            </div>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="coachEmailEdit" placeholder="coach@email.com">
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-save" onclick="saveCoachDetails()">Save Changes</button>
                <button class="btn btn-cancel" onclick="showAdminCoach()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Player Page -->
    <div id="playerPage" class="page">
        <div class="page-header">
            <h2 id="playerPageTitle">Player Details</h2>
            <button class="back-btn" onclick="showRoster()">← Back to Roster</button>
        </div>
        
        <div class="form-container">
            <!-- All your existing form fields here -->
            <div class="form-group">
                <label>Player Name</label>
                <input type="text" id="playerName" readonly style="background: #f5f5f5;">
            </div>
            
            <div class="form-group">
                <label>Nickname (Optional)</label>
                <input type="text" id="playerNickname" placeholder="What do your teammates call you?">
            </div>
            
            <div class="form-group">
                <label>Position Number</label>
                <input type="text" id="playerNumber" placeholder="Enter position number (1-11)">
            </div>
            
            <div class="form-group">
                <label>Position Name</label>
                <input type="text" id="playerPosition" placeholder="Enter position name">
            </div>
            
            <div style="margin: 30px 0;">
                <h3 style="color: #333; margin-bottom: 15px;">Available Questionnaires</h3>
                <button class="nav-btn" onclick="showGoalCornerCard()" style="margin: 0; width: 100%;">
                    <div class="btn-title">Goal & Corner Kick Card</div>
                    <div class="btn-desc">Set positioning for goal kicks and corner kick defense</div>
                </button>
            </div>
            
            <!-- Review Status Display for Player -->
            <div class="admin-section" id="playerReviewStatus" style="display: none;">
                <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; margin: 20px 0;">
                    <h4 style="color: #3b82f6; margin: 0 0 15px 0; text-align: center;">Coach Review Status</h4>
                    <div id="playerReviewStatusText" style="font-weight: bold; margin-bottom: 15px; text-align: center;"></div>
                    
                    <!-- Goal Kick Coach Comments for Player -->
                    <div id="playerGoalKickComments" style="display: none; margin-bottom: 15px; background: #fff; padding: 15px; border-radius: 6px; border-left: 4px solid #10b981;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <strong style="color: #10b981;">Goal Kick Feedback:</strong>
                            <span id="playerGoalKickCoach" style="font-size: 12px; color: #666; font-style: italic;"></span>
                        </div>
                        <div id="playerGoalKickCommentsText" style="color: #333; font-style: italic;"></div>
                    </div>
                    
                    <!-- Corner Kick Coach Comments for Player -->
                    <div id="playerCornerKickComments" style="display: none; background: #fff; padding: 15px; border-radius: 6px; border-left: 4px solid #10b981;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <strong style="color: #10b981;">Corner Kick Defense Feedback:</strong>
                            <span id="playerCornerKickCoach" style="font-size: 12px; color: #666; font-style: italic;"></span>
                        </div>
                        <div id="playerCornerKickCommentsText" style="color: #333; font-style: italic;"></div>
                    </div>
                </div>
            </div>
            
            <!-- MISSING SAVE BUTTON SECTION - ADD THIS -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-save" onclick="savePlayerDetails()">Save Position Info</button>
                <button class="btn btn-cancel" onclick="showRoster()">Cancel</button>
            </div>
            
        </div>
    </div>
        
    <!-- Player Read-Only Page -->
    <div id="playerReadOnlyPage" class="page">
        <div class="page-header">
            <h2 id="readOnlyPlayerTitle">Player Card</h2>
            <button class="back-btn" onclick="showRoster()">← Back to Roster</button>
        </div>
        
        <div class="form-container">
            <div class="admin-section">
                <h3 style="color: #3b82f6; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;">Player Information</h3>
                <div class="admin-info-grid">
                    <div class="admin-info-item">
                        <strong>Name:</strong> <span id="readOnlyPlayerName">-</span>
                    </div>
                    <div class="admin-info-item" id="readOnlyNicknameItem" style="display: none;">
                        <strong>Nickname:</strong> <span id="readOnlyPlayerNickname">-</span>
                    </div>
                    <div class="admin-info-item">
                        <strong>Position Number:</strong> <span id="readOnlyPlayerNumber">-</span>
                    </div>
                    <div class="admin-info-item">
                        <strong>Position Name:</strong> <span id="readOnlyPlayerPosition">-</span>
                    </div>
                </div>
            </div>
            
            <div class="admin-section">
                <h3 style="color: #3b82f6; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;">Goal & Corner Kick Card Responses</h3>
                
                <div class="response-item">
                    <strong>Goal Kick: Where should you be on the pitch/field?</strong>
                    <div class="response-text" id="readOnlyGoalKick">Not answered yet</div>
                </div>
                
                <div class="response-item">
                    <strong>Corner Kick (Defending): Where should you be on the pitch/field?</strong>
                    <div class="response-text" id="readOnlyCornerKick">Not answered yet</div>
                </div>
            </div>
            
            <!-- Review Status Section -->
            <div class="admin-section" id="reviewSection">
                <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; margin: 20px 0;">
                    <h4 style="color: #3b82f6; margin: 0 0 20px 0; text-align: center;">Goal & Corner Kick Card Review</h4>
                    
                    <!-- Goal Kick Comments -->
                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: bold; color: #333; display: block; margin-bottom: 8px;">Goal Kick - Coach Comments:</label>
                        <textarea id="goalKickComments" rows="3" placeholder="Feedback on goal kick positioning..." style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; resize: vertical;"></textarea>
                    </div>
                    
                    <!-- Corner Kick Comments -->
                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: bold; color: #333; display: block; margin-bottom: 8px;">Corner Kick (Defending) - Coach Comments:</label>
                        <textarea id="cornerKickComments" rows="3" placeholder="Feedback on corner kick defending..." style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="text-align: center;">
                        <div id="reviewStatus" style="margin-bottom: 15px; font-weight: bold;"></div>
                        <button id="reviewButton" class="btn" onclick="saveQuestionnaireReview()" style="background: #10b981; color: white;">Save Review & Comments</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Goal & Corner Kick Card Page -->
    <div id="goalCornerPage" class="page">
        <div class="page-header">
            <h2 id="cardPageTitle">Goal & Corner Kick Card</h2>
            <button class="back-btn" onclick="showPlayerPage()">← Back to Player</button>
        </div>
        
        <div class="form-container">
            <div class="form-group">
                <label>Goal Kick: Where should you be on the pitch/field?</label>
                <textarea id="goalKickAnswer" rows="4" placeholder="Describe your positioning during goal kicks..." style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box; resize: vertical;"></textarea>
            </div>
            
            <div class="form-group">
                <label>Corner Kick (Defending): Where should you be on the pitch/field?</label>
                <textarea id="cornerKickAnswer" rows="4" placeholder="Describe your positioning when defending corner kicks..." style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box; resize: vertical;"></textarea>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-save" onclick="saveCardAnswers()">Save Answers</button>
                <button class="btn btn-cancel" onclick="showPlayerPage()">Cancel</button>
            </div>
        </div>
    </div>

    <script>

        
        // Firebase config loaded from external file
        const firebaseConfig = window.firebaseConfig;
        
        // Initialize Firebase

        let db;
        let firebaseReady = false;

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();
            firebaseReady = true;
            console.log('Firebase connected successfully');
            
            // Check if this is a direct player link
            const urlParams = new URLSearchParams(window.location.search);
            const isDirectPlayerLink = urlParams.get('player') && urlParams.get('id');
            
            // Check authentication state
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    currentUser = user;
                    console.log('User signed in:', user.email);
                    showMainApp();
                } else if (isDirectPlayerLink) {
                    // Allow direct player access without authentication
                    currentUser = null;
                    console.log('Direct player link access - bypassing authentication');
                    showMainApp();
                } else {
                    currentUser = null;
                    console.log('User signed out');
                    showLoginPage();
                }
            });
            
        } catch (error) {
            console.log('Firebase not configured yet, using local storage');
            firebaseReady = false;
            // For development without Firebase, show main app
            showMainApp();
        }
        
        // Initialize EmailJS
        emailjs.init({
            publicKey: "WMglO50YF0-hrJ9EL",
        });
        
        var players = [];
        var coaches = [];
        var currentPlayerIndex = -1;
        var currentCoachIndex = -1;
        var currentUser = null;
        var auth;
        
        // Email notification function
        async function sendUpdateNotification(playerName, updateType) {
            console.log('Attempting to send email notification...');
            console.log('Coaches:', coaches);
            
            if (coaches.length === 0) {
                console.log('No coaches to notify');
                return;
            }
            
            const coachEmails = coaches.filter(coach => coach.email).map(coach => coach.email);
            console.log('Coach emails found:', coachEmails);
            
            if (coachEmails.length === 0) {
                console.log('No coach emails available');
                return;
            }
            
            const templateParams = {
                team_name: 'Sierra Surf 2014b Blue Pre-NPL',
                player_name: playerName,
                update_type: updateType,
                timestamp: new Date().toLocaleString(),
                to_email: coachEmails[0]
            };
            
            console.log('Sending email with params:', templateParams);
            
            try {
                const result = await emailjs.send('service_jf13wao', 'template_6bruddy', templateParams);
                console.log('Email notification sent successfully:', result);
            } catch (error) {
                console.error('Failed to send email notification:', error);
            }
        }

        // Authentication functions
        function showLoginPage() {
            hideAllPages();
            document.getElementById('loginPage').className = 'page active';
        }

        function showMainApp() {
            hideAllPages();
            document.getElementById('homePage').className = 'page active';
        }

        async function loginCoach() {
            var email = document.getElementById('loginEmail').value.trim();
            var password = document.getElementById('loginPassword').value.trim();
            var loginBtn = document.getElementById('loginBtn');
            var errorDiv = document.getElementById('loginError');
            
            if (!email || !password) {
                showLoginError('Please enter both email and password');
                return;
            }
            
            // Show loading state
            loginBtn.textContent = 'Signing In...';
            loginBtn.disabled = true;
            errorDiv.style.display = 'none';
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                // Success handled by onAuthStateChanged
            } catch (error) {
                console.error('Login error:', error);
                showLoginError(getErrorMessage(error.code));
                
                // Reset button
                loginBtn.textContent = 'Sign In';
                loginBtn.disabled = false;
            }
        }

        function showLoginError(message) {
            var errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function getErrorMessage(errorCode) {
            switch(errorCode) {
                case 'auth/user-not-found':
                    return 'No account found with this email. Contact the head coach.';
                case 'auth/wrong-password':
                    return 'Incorrect password. Please try again.';
                case 'auth/invalid-email':
                    return 'Please enter a valid email address.';
                case 'auth/too-many-requests':
                    return 'Too many failed attempts. Please try again later.';
                default:
                    return 'Login failed. Please try again or contact the head coach.';
            }
        }

        async function signOutCoach() {
            try {
                await auth.signOut();
            } catch (error) {
                console.error('Sign out error:', error);
            }
        }

        // Data persistence functions
        async function savePlayersToCloud() {
            if (!firebaseReady) {
                // Fallback to localStorage
                localStorage.setItem('soccerPlayers', JSON.stringify(players));
                localStorage.setItem('soccerCoaches', JSON.stringify(coaches));
                return;
            }
            
            try {
                await db.collection('teams').doc('2014-blue').set({
                    players: players,
                    coaches: coaches,
                    lastUpdated: new Date()
                });
                console.log('Data saved to cloud');
            } catch (error) {
                console.error('Error saving to cloud:', error);
                // Fallback to localStorage
                localStorage.setItem('soccerPlayers', JSON.stringify(players));
                localStorage.setItem('soccerCoaches', JSON.stringify(coaches));
            }
        }
        
        async function loadPlayersFromCloud() {
            if (!firebaseReady) {
                // Fallback to localStorage
                const savedPlayers = localStorage.getItem('soccerPlayers');
                const savedCoaches = localStorage.getItem('soccerCoaches');
                if (savedPlayers) players = JSON.parse(savedPlayers);
                if (savedCoaches) coaches = JSON.parse(savedCoaches);
                return;
            }
            
            try {
                const doc = await db.collection('teams').doc('2014-blue').get();
                if (doc.exists) {
                    const data = doc.data();
                    players = data.players || [];
                    coaches = data.coaches || [];
                    console.log('Data loaded from cloud');
                } else {
                    console.log('No cloud data found, starting fresh');
                }
            } catch (error) {
                console.error('Error loading from cloud:', error);
                // Fallback to localStorage for direct player links
                const savedPlayers = localStorage.getItem('soccerPlayers');
                const savedCoaches = localStorage.getItem('soccerCoaches');
                if (savedPlayers) players = JSON.parse(savedPlayers);
                if (savedCoaches) coaches = JSON.parse(savedCoaches);
            }
        }
        
        // Navigation functions
        function showHome() {
            hideAllPages();
            document.getElementById('homePage').className = 'page active';
        }
        
        function showAddPlayer() {
            hideAllPages();
            document.getElementById('addPlayerPage').className = 'page active';
            
            // Add header to the page
            var pageContent = document.getElementById('addPlayerPage');
            var existingContent = pageContent.innerHTML;
            
            // Check if header already exists
            if (!pageContent.querySelector('.header')) {
                pageContent.innerHTML = createPageHeader('Add New Player', 'Add a player to the 2014 Blue Team roster') + existingContent;
            }
            
            document.getElementById('newPlayerName').value = '';
        }
        
        function showRoster() {
            hideAllPages();
            document.getElementById('rosterPage').className = 'page active';
            
            var pageContent = document.getElementById('rosterPage');
            if (!pageContent.querySelector('.header')) {
                var existingContent = pageContent.innerHTML;
                pageContent.innerHTML = createPageHeader('Team Roster', 'View and select players to edit') + existingContent;
            }
            
            displayRoster();
        }

        function showAddCoach() {
            hideAllPages();
            document.getElementById('addCoachPage').className = 'page active';
            
            var pageContent = document.getElementById('addCoachPage');
            if (!pageContent.querySelector('.header')) {
                var existingContent = pageContent.innerHTML;
                pageContent.innerHTML = createPageHeader('Add New Coach', 'Add coaching staff to the system') + existingContent;
            }
            
            document.getElementById('newCoachName').value = '';
            document.getElementById('coachRole').value = '';
            document.getElementById('coachEmail').value = '';
        }

        function showAdmin() {
            hideAllPages();
            document.getElementById('adminPage').className = 'page active';
            
            var pageContent = document.getElementById('adminPage');
            if (!pageContent.querySelector('.header')) {
                var existingContent = pageContent.innerHTML;
                pageContent.innerHTML = createPageHeader('Admin Panel', 'Manage all player data and responses', true) + existingContent;
            }
            
            displayAdminRoster();
        }
        
        function showAdminPlayer() {
            hideAllPages();
            document.getElementById('adminPlayerPage').className = 'page active';
            
            var pageContent = document.getElementById('adminPlayerPage');
            if (!pageContent.querySelector('.header')) {
                var existingContent = pageContent.innerHTML;
                pageContent.innerHTML = createPageHeader('Player Admin', 'Manage player data and responses', true) + existingContent;
            }
            
            if (currentPlayerIndex >= 0) {
                loadAdminPlayerDetails();
            }
        }

        function showAdminCoach() {
            hideAllPages();
            document.getElementById('adminCoachPage').className = 'page active';
            
            var pageContent = document.getElementById('adminCoachPage');
            if (!pageContent.querySelector('.header')) {
                var existingContent = pageContent.innerHTML;
                pageContent.innerHTML = createPageHeader('Coach Admin', 'Manage coaching staff information', true) + existingContent;
            }
            
            if (currentCoachIndex >= 0) {
                loadAdminCoachDetails();
            }
        }

        function showPlayerPage() {
            hideAllPages();
            document.getElementById('playerPage').className = 'page active';
            
            var pageContent = document.getElementById('playerPage');
            if (!pageContent.querySelector('.header')) {
                var existingContent = pageContent.innerHTML;
                pageContent.innerHTML = createPageHeader('Player Details', 'Update your position and card information') + existingContent;
            }
            
            if (currentPlayerIndex >= 0) {
                loadPlayerDetails();
            }
        }

        function showPlayerReadOnlyPage() {
            hideAllPages();
            document.getElementById('playerReadOnlyPage').className = 'page active';
            
            var pageContent = document.getElementById('playerReadOnlyPage');
            if (!pageContent.querySelector('.header')) {
                var existingContent = pageContent.innerHTML;
                pageContent.innerHTML = createPageHeader('Player Card', 'View and review player information', true) + existingContent;
            }
            
            if (currentPlayerIndex >= 0) {
                loadPlayerReadOnlyDetails();
            }
        }

        function showCoachPage() {
            hideAllPages();
            document.getElementById('coachPage').className = 'page active';
            
            var pageContent = document.getElementById('coachPage');
            if (!pageContent.querySelector('.header')) {
                var existingContent = pageContent.innerHTML;
                pageContent.innerHTML = createPageHeader('Coach Details', 'Edit coaching staff information', true) + existingContent;
            }
            
            if (currentCoachIndex >= 0) {
                loadCoachDetails();
            }
        }

        function loadAdminCoachDetails() {
            var coach = coaches[currentCoachIndex];
            
            document.getElementById('adminCoachTitle').textContent = 'Admin: ' + coach.name;
            document.getElementById('adminCoachName').textContent = coach.name;
            document.getElementById('adminCoachRole').textContent = coach.role;
            document.getElementById('adminCoachEmail').textContent = coach.email || 'No email provided';
            document.getElementById('adminCoachAdded').textContent = coach.addedDate || 'Unknown';
        }

        function loadCoachDetails() {
            var coach = coaches[currentCoachIndex];
            document.getElementById('coachPageTitle').textContent = coach.name + ' - Coach Details';
            document.getElementById('coachName').value = coach.name;
            document.getElementById('coachRoleEdit').value = coach.role;
            document.getElementById('coachEmailEdit').value = coach.email || '';
        }

        function showGoalCornerCard() {
            hideAllPages();
            document.getElementById('goalCornerPage').className = 'page active';
            
            var pageContent = document.getElementById('goalCornerPage');
            if (!pageContent.querySelector('.header')) {
                var existingContent = pageContent.innerHTML;
                pageContent.innerHTML = createPageHeader('Goal & Corner Kick Card', 'Set your positioning for game situations') + existingContent;
            }
            
            if (currentPlayerIndex >= 0) {
                loadCardAnswers();
            }
        }
        
        function hideAllPages() {
            var pages = document.getElementsByClassName('page');
            for (var i = 0; i < pages.length; i++) {
                pages[i].className = 'page';
            }
        }
        
        // Coach functions
        async function saveNewCoach() {
            var name = document.getElementById('newCoachName').value.trim();
            var role = document.getElementById('coachRole').value.trim();
            var email = document.getElementById('coachEmail').value.trim();
            
            if (!name) {
                alert('Please enter a coach name');
                return;
            }
            
            var newCoach = {
                name: name,
                role: role || 'Coach',
                email: email,
                addedDate: new Date().toISOString().split('T')[0]
            };
            
            coaches.push(newCoach);
            await savePlayersToCloud();
            alert('Coach "' + name + '" added successfully!');
            showHome();
        }

        async function deleteCoachAdmin() {
            var coach = coaches[currentCoachIndex];
            if (confirm('Are you sure you want to delete coach ' + coach.name + '? This cannot be undone.')) {
                coaches.splice(currentCoachIndex, 1);
                await savePlayersToCloud();
                alert('Coach deleted successfully');
                showAdmin();
            }
        }
        
        // Player functions
async function saveNewPlayer() {
            var name = document.getElementById('newPlayerName').value.trim();
            
            if (!name) {
                alert('Please enter a player name');
                return;
            }
            
            var newPlayer = {
                name: name,
                nickname: '',
                number: '',
                position: '',
                goalKick: '',
                cornerKick: '',
                goalKickComments: '',
                cornerKickComments: '',
                needsReview: false,
                uuid: generateUUID() // Add unique ID
            };
            
            players.push(newPlayer);
            await savePlayersToCloud();
            alert('Player "' + name + '" added successfully!');
            showHome();
        }
        
        function displayRoster() {
            var container = document.getElementById('rosterList');
            
            if (players.length === 0 && coaches.length === 0) {
                container.innerHTML = '<div class="empty-message">No players or coaches in roster yet</div>';
                return;
            }
            
            var html = '';
            
            // Coaches Section
            if (coaches.length > 0) {
                html += '<div style="margin-bottom: 30px;">';
                html += '<h3 style="color: #10b981; border-bottom: 2px solid #10b981; padding-bottom: 10px; margin-bottom: 20px;">Coaches</h3>';
                
                for (var i = 0; i < coaches.length; i++) {
                    var coach = coaches[i];
                    html += '<div class="player-item" style="cursor: default;">';
                    html += '<div>';
                    html += '<div class="player-name" style="color: #10b981;">' + coach.name + '</div>';
                    html += '<div style="color: #10b981; font-weight: bold;">' + coach.role + '</div>';
                    html += '</div>';
                    html += '</div>';
                }
                html += '</div>';
            }
            
            // Players Section
            if (players.length > 0) {
                html += '<div>';
                html += '<h3 style="color: #3b82f6; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; margin-bottom: 20px;">Players</h3>';
                
                for (var i = 0; i < players.length; i++) {
                    var player = players[i];
                    
                    // Determine player status
                    var hasBasicInfo = player.number && player.position;
                    var hasResponses = player.goalKick || player.cornerKick;
                    var needsReview = player.needsReview || false;
                    
                    var statusColor = '#3b82f6'; // Default blue
                    var statusIndicator = '';
                    
                    // Red if missing basic info or no responses
                    if (!hasBasicInfo || !hasResponses) {
                        statusColor = '#ef4444'; // Red
                        statusIndicator = '🔴 ';
                    }
                    // Orange if needs review
                    else if (needsReview) {
                        statusColor = '#f59e0b'; // Orange
                        statusIndicator = '🟡 ';
                    }
                    // Green if all complete and reviewed
                    else {
                        statusColor = '#10b981'; // Green
                        statusIndicator = '🟢 ';
                    }
                    
                    html += '<div class="player-item" onclick="selectPlayerReadOnly(' + i + ')" style="border-left: 4px solid ' + statusColor + ';">';
                    html += '<div>';
                    html += '<div class="player-name">' + statusIndicator + player.name + '</div>';
                    
                    // Status line
                    var statusLine = '';
                    if (player.number && player.position) {
                        statusLine += '#' + player.number + ' - ' + player.position;
                    } else {
                        statusLine += 'Position not set';
                    }
                    
                    // Add status indicators
                    var statusMessages = [];
                    if (!hasBasicInfo) {
                        statusMessages.push('Missing position info');
                    }
                    if (!hasResponses) {
                        statusMessages.push('No card responses');
                    }
                    if (needsReview) {
                        statusMessages.push('Needs review');
                    }
                    if (hasBasicInfo && hasResponses && !needsReview) {
                        statusMessages.push('Complete & reviewed');
                    }
                    
                    if (statusMessages.length > 0) {
                        statusLine += ' • ' + statusMessages.join(' • ');
                    }
                    
                    html += '<div style="color: ' + statusColor + '; font-weight: bold; font-size: 14px;">' + statusLine + '</div>';
                    html += '</div>';
                    html += '<div style="color: ' + statusColor + ';">→</div>';
                    html += '</div>';
                }
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        function selectCoach(index) {
            currentPlayerIndex = -1; // Reset player index
            currentCoachIndex = index;
            showCoachPage();
        }

        function selectPlayer(index) {
            currentPlayerIndex = index;
            showPlayerPage();
        }

        function selectPlayerReadOnly(index) {
            currentPlayerIndex = index;
            showPlayerReadOnlyPage();
        }        
        
        function loadPlayerDetails() {
            var player = players[currentPlayerIndex];
            document.getElementById('playerPageTitle').textContent = player.name + ' - Details';
            document.getElementById('playerName').value = player.name;
            document.getElementById('playerNickname').value = player.nickname || '';
            document.getElementById('playerNumber').value = player.number;
            document.getElementById('playerPosition').value = player.position;
            
            // Show review status for player
            updatePlayerReviewStatus();
        }
        
        function loadPlayerReadOnlyDetails() {
            var player = players[currentPlayerIndex];
            
            document.getElementById('readOnlyPlayerTitle').textContent = player.name + ' - Player Card';
            document.getElementById('readOnlyPlayerName').textContent = player.name;
            document.getElementById('readOnlyPlayerNumber').textContent = player.number || 'Not set';
            document.getElementById('readOnlyPlayerPosition').textContent = player.position || 'Not set';
            
            // Show nickname if it exists
            var nicknameItem = document.getElementById('readOnlyNicknameItem');
            var nicknameSpan = document.getElementById('readOnlyPlayerNickname');
            if (player.nickname) {
                nicknameSpan.textContent = player.nickname;
                nicknameItem.style.display = 'block';
            } else {
                nicknameItem.style.display = 'none';
            }
            
            var goalKickElement = document.getElementById('readOnlyGoalKick');
            var cornerKickElement = document.getElementById('readOnlyCornerKick');
            
            if (player.goalKick) {
                goalKickElement.textContent = player.goalKick;
                goalKickElement.className = 'response-text answered';
            } else {
                goalKickElement.textContent = 'Not answered yet';
                goalKickElement.className = 'response-text';
            }
            
            if (player.cornerKick) {
                cornerKickElement.textContent = player.cornerKick;
                cornerKickElement.className = 'response-text answered';
            } else {
                cornerKickElement.textContent = 'Not answered yet';
                cornerKickElement.className = 'response-text';
            }

            // Update review status display
            updateReviewStatusDisplay();
        }

        function updateReviewStatusDisplay() {
            var player = players[currentPlayerIndex];
            var reviewStatusElement = document.getElementById('reviewStatus');
            var reviewButtonElement = document.getElementById('reviewButton');
            var reviewSectionElement = document.getElementById('reviewSection');
            var goalKickCommentsTextarea = document.getElementById('goalKickComments');
            var cornerKickCommentsTextarea = document.getElementById('cornerKickComments');
            
            // Only show review section if player has responses
            var hasResponses = player.goalKick || player.cornerKick;
            if (!hasResponses) {
                reviewSectionElement.style.display = 'none';
                return;
            }
            
            reviewSectionElement.style.display = 'block';
            
            // Load existing comments
            if (goalKickCommentsTextarea) {
                goalKickCommentsTextarea.value = player.goalKickComments || '';
            }
            if (cornerKickCommentsTextarea) {
                cornerKickCommentsTextarea.value = player.cornerKickComments || '';
            }
            
            if (player.needsReview) {
                reviewStatusElement.textContent = '🟡 Responses need coach review';
                reviewStatusElement.style.color = '#f59e0b';
                reviewButtonElement.textContent = 'Save Review & Comments';
                reviewButtonElement.style.background = '#10b981';
            } else {
                reviewStatusElement.textContent = '✅ Responses have been reviewed by coach';
                reviewStatusElement.style.color = '#10b981';
                reviewButtonElement.textContent = 'Update Review & Comments';
                reviewButtonElement.style.background = '#3b82f6';
            }
        }

        function updatePlayerReviewStatus() {
            var player = players[currentPlayerIndex];
            var reviewStatusSection = document.getElementById('playerReviewStatus');
            var reviewStatusText = document.getElementById('playerReviewStatusText');
            var goalKickCommentsDiv = document.getElementById('playerGoalKickComments');
            var cornerKickCommentsDiv = document.getElementById('playerCornerKickComments');
            var goalKickCommentsText = document.getElementById('playerGoalKickCommentsText');
            var cornerKickCommentsText = document.getElementById('playerCornerKickCommentsText');
            
            // Only show if player has responses
            var hasResponses = player.goalKick || player.cornerKick;
            if (!hasResponses) {
                reviewStatusSection.style.display = 'none';
                return;
            }
            
            reviewStatusSection.style.display = 'block';
            
            if (player.needsReview) {
                reviewStatusText.textContent = '⏳ Your responses are waiting for coach review';
                reviewStatusText.style.color = '#f59e0b';
                goalKickCommentsDiv.style.display = 'none';
                cornerKickCommentsDiv.style.display = 'none';
            } else {
                reviewStatusText.textContent = '✅ Your responses have been reviewed by your coach!';
                reviewStatusText.style.color = '#10b981';
                
                // Show goal kick comments if they exist
                if (player.goalKickComments) {
                    goalKickCommentsText.textContent = player.goalKickComments;
                    goalKickCommentsDiv.style.display = 'block';
                } else {
                    goalKickCommentsDiv.style.display = 'none';
                }
                
                // Show corner kick comments if they exist
                if (player.cornerKickComments) {
                    cornerKickCommentsText.textContent = player.cornerKickComments;
                    cornerKickCommentsDiv.style.display = 'block';
                } else {
                    cornerKickCommentsDiv.style.display = 'none';
                }
            }
        }

        async function togglePlayerReview() {
            // This function is now replaced by saveQuestionnaireReview()
            // Keep for backward compatibility, but redirect to new function
            await saveQuestionnaireReview();
        }

        async function savePlayerDetails() {
            var number = document.getElementById('playerNumber').value.trim();
            var position = document.getElementById('playerPosition').value.trim();
            var nickname = document.getElementById('playerNickname').value.trim();
            
            if (number && position) {
                players[currentPlayerIndex].number = number;
                players[currentPlayerIndex].position = position;
                players[currentPlayerIndex].nickname = nickname;
                await savePlayersToCloud();
                
                await sendUpdateNotification(players[currentPlayerIndex].name, 'position information');
                
                alert('Position information saved!');
                
                // Check if this is direct player access
                const urlParams = new URLSearchParams(window.location.search);
                const isDirectPlayerLink = urlParams.get('uuid');
                
                if (isDirectPlayerLink) {
                    // Stay on player page for direct access
                    hideAllPages();
                    document.getElementById('playerPage').className = 'page active';
                    loadPlayerDetails();
                } else {
                    // Go to roster for coach access
                    showRoster();
                }
            } else {
                alert('Please fill in both position number and position name');
            }
        }
        
        function loadCardAnswers() {
            var player = players[currentPlayerIndex];
            document.getElementById('cardPageTitle').textContent = player.name + ' - Goal & Corner Kick Card';
            document.getElementById('goalKickAnswer').value = player.goalKick;
            document.getElementById('cornerKickAnswer').value = player.cornerKick;
        }
        
        async function saveCardAnswers() {
            var goalKick = document.getElementById('goalKickAnswer').value.trim();
            var cornerKick = document.getElementById('cornerKickAnswer').value.trim();
            
            var saveBtn = document.querySelector('#goalCornerPage .btn-save');
            var originalText = saveBtn.textContent;
            saveBtn.textContent = 'Uploading...';
            saveBtn.disabled = true;
            
            try {
                players[currentPlayerIndex].goalKick = goalKick;
                players[currentPlayerIndex].cornerKick = cornerKick;
                
                if (goalKick || cornerKick) {
                    players[currentPlayerIndex].needsReview = true;
                }
                
                await savePlayersToCloud();
                await sendUpdateNotification(players[currentPlayerIndex].name, 'Goal & Corner Kick questionnaire');
                
                alert('Answers uploaded successfully!');
                
                // Check if this is direct player access
                const urlParams = new URLSearchParams(window.location.search);
                const isDirectPlayerLink = urlParams.get('uuid');
                
                if (isDirectPlayerLink) {
                    // Stay on player page for direct access
                    hideAllPages();
                    document.getElementById('playerPage').className = 'page active';
                    loadPlayerDetails();
                } else {
                    // Go to player page for coach access
                    showPlayerPage();
                }
                
            } catch (error) {
                console.error('Error saving answers:', error);
                alert('Error uploading answers. Please try again.');
                
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            }
        }
        
        // Generate a random UUID
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0;
                var v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Admin functions
        function displayAdminRoster() {
            var container = document.getElementById('adminRosterList');
            
            if (players.length === 0 && coaches.length === 0) {
                container.innerHTML = '<div class="empty-message">No players or coaches in system yet</div>';
                return;
            }
            
            var html = '';
            
            // Display coaches first
            for (var i = 0; i < coaches.length; i++) {
                var coach = coaches[i];
                html += '<div class="player-item" onclick="selectAdminCoach(' + i + ')">';
                html += '<div>';
                html += '<div class="player-name">' + coach.name + ' (Coach)</div>';
                html += '<div style="color: #666; font-size: 14px;">' + coach.role + ' • ' + (coach.email || 'No email') + '</div>';
                html += '</div>';
                html += '<div style="color: #10b981;">→</div>';
                html += '</div>';
            }
            
            // Display players
            for (var i = 0; i < players.length; i++) {
                var player = players[i];
                var hasResponses = player.goalKick || player.cornerKick;
                
                html += '<div class="player-item" onclick="selectAdminPlayer(' + i + ')">';
                html += '<div>';
                html += '<div class="player-name">' + player.name + '</div>';
                
                var statusLine = '';
                if (player.number && player.position) {
                    statusLine += '#' + player.number + ' - ' + player.position;
                } else {
                    statusLine += 'Position not set';
                }
                
                if (hasResponses) {
                    statusLine += ' • Has responses';
                } else {
                    statusLine += ' • No responses';
                }
                
                html += '<div style="color: #666; font-size: 14px;">' + statusLine + '</div>';
                html += '</div>';
                html += '<div style="color: #3b82f6;">→</div>';
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        function selectAdminPlayer(index) {
            currentPlayerIndex = index;
            showAdminPlayer();
        }

        function selectAdminCoach(index) {
            currentCoachIndex = index;
            currentPlayerIndex = -1; // Reset player index
            showAdminCoach();
        }
        
        function loadAdminPlayerDetails() {
            var player = players[currentPlayerIndex];
            
            document.getElementById('adminPlayerTitle').textContent = 'Admin: ' + player.name;
            document.getElementById('adminPlayerName').textContent = player.name;
            document.getElementById('adminPlayerNumber').textContent = player.number || 'Not set';
            document.getElementById('adminPlayerPosition').textContent = player.position || 'Not set';
            
            var goalKickElement = document.getElementById('adminGoalKick');
            var cornerKickElement = document.getElementById('adminCornerKick');
            
            if (player.goalKick) {
                goalKickElement.textContent = player.goalKick;
                goalKickElement.className = 'response-text answered';
            } else {
                goalKickElement.textContent = 'Not answered';
                goalKickElement.className = 'response-text';
            }
            
            if (player.cornerKick) {
                cornerKickElement.textContent = player.cornerKick;
                cornerKickElement.className = 'response-text answered';
            } else {
                cornerKickElement.textContent = 'Not answered';
                cornerKickElement.className = 'response-text';
            }
        }
        
        // New function to save questionnaire-specific review and comments
        async function saveQuestionnaireReview() {
            var player = players[currentPlayerIndex];
            var goalKickCommentsTextarea = document.getElementById('goalKickComments');
            var cornerKickCommentsTextarea = document.getElementById('cornerKickComments');
            
            var goalKickComments = goalKickCommentsTextarea ? goalKickCommentsTextarea.value.trim() : '';
            var cornerKickComments = cornerKickCommentsTextarea ? cornerKickCommentsTextarea.value.trim() : '';
            
            // Update player data
            player.goalKickComments = goalKickComments;
            player.cornerKickComments = cornerKickComments;
            player.needsReview = false; // Mark as reviewed
            player.reviewedDate = new Date().toISOString().split('T')[0];
            
            await savePlayersToCloud();
            
            // Update the display
            updateReviewStatusDisplay();
            
            // Show confirmation
            var hasComments = goalKickComments || cornerKickComments;
            if (hasComments) {
                alert('Review saved with feedback for ' + player.name + '!');
            } else {
                alert(player.name + ' marked as reviewed!');
            }
        }

        function printPlayerCard() {
            alert('Print functionality coming soon!');
        }
        
        async function deletePlayerAdmin() {
            var player = players[currentPlayerIndex];
            if (confirm('Are you sure you want to delete ' + player.name + '? This cannot be undone.')) {
                players.splice(currentPlayerIndex, 1);
                await savePlayersToCloud();
                alert('Player deleted successfully');
                showAdmin();
            }
        }
        
        function showCoachEditPage() {
            hideAllPages();
            document.getElementById('coachPage').className = 'page active';
            if (currentCoachIndex >= 0) {
                loadCoachDetails();
            }
        }

        async function saveCoachDetails() {
            var name = document.getElementById('coachName').value.trim();
            var role = document.getElementById('coachRoleEdit').value.trim();
            var email = document.getElementById('coachEmailEdit').value.trim();
            
            if (!name) {
                alert('Please enter a coach name');
                return;
            }
            
            if (!role) {
                alert('Please enter a role');
                return;
            }
            
            coaches[currentCoachIndex].name = name;
            coaches[currentCoachIndex].role = role;
            coaches[currentCoachIndex].email = email;
            
            await savePlayersToCloud();
            alert('Coach information updated successfully!');
            showAdminCoach();
        }

        function generatePlayerLink() {
            var player = players[currentPlayerIndex];
            var baseUrl = window.location.href;
            
            // Handle different URL scenarios
            if (baseUrl.includes('about:srcdoc') || baseUrl.includes('blob:')) {
                baseUrl = 'https://yourserver.com/soccer-cards.html';
            } else {
                baseUrl = baseUrl.split('?')[0];
            }
            
            // Use UUID instead of player name and index
            var playerLink = baseUrl + '?uuid=' + player.uuid;
            
            document.getElementById('playerLinkInput').value = playerLink;
            document.getElementById('playerLinkSection').style.display = 'block';
            
            if (window.location.href.includes('about:srcdoc') || window.location.href.includes('blob:')) {
                var instruction = document.createElement('p');
                instruction.style.cssText = 'margin: 10px 0; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; color: #856404; font-size: 12px;';
                instruction.innerHTML = '<strong>Note:</strong> Replace "yourserver.com/soccer-cards.html" with your actual website URL when you deploy this file.';
                document.getElementById('playerLinkSection').appendChild(instruction);
            }
        }
        
        function copyPlayerLink() {
            var linkInput = document.getElementById('playerLinkInput');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                alert('Link copied to clipboard!');
            } catch (err) {
                alert('Unable to copy automatically. Please select and copy the link manually.');
            }
        }
        function createPageHeader(title, subtitle, showSignOut = false) {
            var headerHTML = `
                <div class="header">
                    <div class="header-content">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div class="logo-container">
                                    <img src="https://sierrasurfsoccerclub.net/wp-content/uploads/2023/04/Sierra-Surf-Logo-3D-shield-blackoutline-232x300-1.png" alt="Sierra Surf Soccer Club" class="logo">
                                    <div>
                                        <h1>${title}</h1>
                                        <p>${subtitle}</p>
                                    </div>
                                </div>
                            </div>
                            ${showSignOut ? '<button onclick="signOutCoach()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease;">Sign Out</button>' : ''}
                        </div>
                    </div>
                </div>
            `;
            return headerHTML;
        }
        
        // Check for direct player link on page load
        function checkDirectPlayerAccess() {
            var urlParams = new URLSearchParams(window.location.search);
            var playerUUID = urlParams.get('uuid');
            
            if (playerUUID) {
                // Find player by UUID instead of name/index
                var playerIndex = players.findIndex(player => player.uuid === playerUUID);
                
                if (playerIndex >= 0) {
                    currentPlayerIndex = playerIndex;
                    
                    hideAllPages();
                    document.getElementById('playerPage').className = 'page active';
                    
                    // Add the blue header with logo to the player page
                    var pageContent = document.getElementById('playerPage');
                    if (!pageContent.querySelector('.header')) {
                        var existingContent = pageContent.innerHTML;
                        pageContent.innerHTML = createPageHeader('Player Details', 'Update your position and card information') + existingContent;
                    }
                    
                    loadPlayerDetails();
                    
                    // Update the title to show player's name
                    document.getElementById('playerPageTitle').textContent = players[playerIndex].name + ' - Your Soccer Card';
                    
                    // Update the back button to be a "Done" button
                    var backBtn = document.querySelector('#playerPage .back-btn');
                    backBtn.textContent = '✓ Done';
                    backBtn.onclick = function() {
                        if (confirm('Are you finished updating your information?')) {
                            alert('Your information has been saved! You can close this tab or bookmark this page to return anytime.');
                        }
                    };
                    
                    // Update all cancel buttons to stay on player page for direct access
                    var cancelBtns = document.querySelectorAll('#playerPage .btn-cancel');
                    cancelBtns.forEach(function(btn) {
                        btn.onclick = function() {
                            hideAllPages();
                            document.getElementById('playerPage').className = 'page active';
                        };
                    });
                    
                    // Update goal/corner page cancel button
                    var goalCornerCancelBtn = document.querySelector('#goalCornerPage .btn-cancel');
                    if (goalCornerCancelBtn) {
                        goalCornerCancelBtn.onclick = function() {
                            hideAllPages();
                            document.getElementById('playerPage').className = 'page active';
                        };
                    }
                    
                    // Hide the home page navigation for direct access
                    document.getElementById('homePage').style.display = 'none';
                    
                    // Update the goal/corner card page back button
                    var cardBackBtn = document.querySelector('#goalCornerPage .back-btn');
                    cardBackBtn.onclick = function() {
                        hideAllPages();
                        document.getElementById('playerPage').className = 'page active';
                    };
                    
                } else {
                    alert('Invalid player link. Please contact your coach for a new link.');
                }
            }
        }
        
        // Load players and check for direct access when page loads
        window.addEventListener('load', async function() {
            await loadPlayersFromCloud();
            checkDirectPlayerAccess();
            
            // Refresh displays if we're on a page that shows players
            if (document.getElementById('rosterPage').classList.contains('active')) {
                displayRoster();
            }
            if (document.getElementById('adminPage').classList.contains('active')) {
                displayAdminRoster();
            }
        });
    </script>
</body>
</html>
